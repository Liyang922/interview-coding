<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        margin: 0;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="jsContainer">
      <ul class="js-test" id="jsParent">
        <li data-index="0">1</li>
        <li data-index="1">2</li>
      </ul>
      <span style="font-weight: bold">3</span>
      4
    </div>
    <script>

      function dom2json() {
        // nodeType = 1 or 3
        // tag content(trim) 空忽略
        // tag attributes children
        let domA = document.getElementById("jsContainer");
        return createObj(domA);
      }

      let obj = dom2json();
      console.log(obj);

      function createObj(node) {
        const obj = {};

        // nodeName
        obj.tag = node.nodeName.toLowerCase().replace("#", "");

        // content
        if(obj.tag == "text") {
            obj.content = node.textContent.trim();
            return obj;
        }

        // attributes
        obj.attributes = {};
        if(node.hasAttributes()) {
            let attrs = node.attributes;
            for (let i = 0; i < attrs.length; i++) {
                obj.attributes[attrs[i].name] = attrs[i].value;
            }
        }


        // children
        obj.children = [];
        if(node.hasChildNodes()) {
            node.childNodes.forEach(childNode => {
                if(!(childNode.nodeName == "#text" && childNode.textContent.trim() == "")) {
                    obj.children.push(createObj(childNode));
                }
            });
        }
        return obj;
      }
    </script>
  </body>
</html>
