<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body,
      html {
        padding: 0;
        margin: 0;
        font-size: 14px;
        color: #000000;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        table-layout: fixed;
      }
      thead {
        background: #3d444c;
        color: #ffffff;
      }
      td,
      th {
        border: 1px solid #e1e1e1;
        padding: 0;
        height: 30px;
        line-height: 30px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <table id="jsTrolley">
      <thead>
        <tr>
          <th>名称</th>
          <th>价格</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>产品1</td>
          <td>10.00</td>
          <td><a href="javascript:void(0);">删除</a></td>
        </tr>
        <tr>
          <td>产品2</td>
          <td>30.20</td>
          <td><a href="javascript:void(0);">删除</a></td>
        </tr>
        <tr>
          <td>产品3</td>
          <td>20.50</td>
          <td><a href="javascript:void(0);">删除</a></td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <th>总计</th>
          <td colspan="2">60.70(3件商品)</td>
        </tr>
      </tfoot>
    </table>

    <script type="text/javascript">
      function add(items) {
        // let tbody = jsTrolley.tBodies[0];
        let tbody = document.querySelector("tbody");

        // let sumTd = document.querySelector("tfoot td");
        // let sum = +sumTd.textContent.match(/\d{1,}.\d{2}/)[0];
        // let num = +sumTd.textContent.match(/\d(?=件)/)[0];

        items.forEach((item) => {
          let tr = document.createElement("tr");
          tr.innerHTML = `<td>${item.name}</td><td>${item.price}</td><td><a href="javascript:void(0);">删除</a></td>`;
          tbody.append(tr);
        //   num++;
        //   sum += item.price;
        });

        renderSum();
        // sumTd.textContent = `${sum.toFixed(2)}(${num}件商品)`;
      }

      function bind() {
        // querySelectorAll返回nodelist，不是array，但有forEach方法
        let deleteButton = document.querySelectorAll("a[href*='void']");
        deleteButton.forEach((button) => {
          button.onclick = function () {
            let targetTr = button.closest("tr");
            targetTr.remove();
            renderSum();
          };
        });
      }

      function renderSum() {
        let sumTd = document.querySelector("tfoot td");
        let sum = 0;
        let num = 0;

        // querySelector还是比table自带的导航属性好用
        let tds = document.querySelectorAll("tbody tr td:nth-child(2)");
        num = tds.length;
        tds.forEach(td => {
            // html中写好的每个标签后都有一个空白的textNode，共有7个子节点
            // js加入的tr，只有3个td子节点？why？
            // let price = tr.childNodes[3].textContent;
            // 用children代替childNodes就可以了！只有元素节点，没有文本注释节点

            let price = +td.textContent;
            sum += +price;
        })

        sumTd.textContent = `${sum.toFixed(2)}(${num}件商品)`;
      }

      add([
        {
          name: "li",
          price: 10.0,
        },
      ]);

      bind();
    </script>
  </body>
</html>
